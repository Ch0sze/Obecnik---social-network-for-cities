<div class="create-post-modal-container">
    <form asp-controller="Posts" asp-action="Create" id="createPostForm" onsubmit="return validateForm()" enctype="multipart/form-data">
        <div id="createPostModal" class="modal fade" tabindex="-1" data-bs-backdrop="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <h3 id="postTitleHeader" class="modal-header">Vytvořit příspěvek</h3>

                    @* <div class="button-group"> *@
                    @*     <button type="button" id="discussionButton" class="type-button active ButtonPopup">Diskuze</button> *@
                        @* <button type="button" id="actionButton" class="type-button ButtonPopup">Akce</button> *@
                        @* <button type="button" id="petitionButton" class="type-button ButtonPopup">Petice</button> *@
                    @* </div> *@

                    <input name="Title" type="text" class="input-field" placeholder="O co se jedná?" id="postTitle" maxlength="100" required/>
                    <span id="titleError" class="error-message" style="color: red; display: none; font-size: 12px; margin-left: 2px;">Je potřeba napsat předmět.</span>
                    <span id="titleLength" style="font-size: 12px; color: gray; margin-bottom: 12px; margin-left: 2px;">0/100</span>

                    <textarea name="Content" class="textarea-field" placeholder="Co se děje u vás?" id="postContent" maxlength="1000" required
                        style="height: 150px; resize: none;"
                    ></textarea>
                    <span id="contentError" class="error-message" style="color: red; display: none; font-size: 12px; margin-left: 2px;">Je potřeba napsat popis.</span>
                    <span id="contentLength" style="font-size: 12px; color: gray; margin-left: 2px;">0/1000</span>

                    <div class="icon-group">
                        <div class="icon-button">
                            <label for="uploadImage" class="icon-label">
                                <img src="/icons/image_icon.svg" class="icon"/>
                            </label>
                            <input type="file" id="uploadImage" name="Photo" style="display: none;" accept=".png, .jpeg, .jpg"/>
                        </div>

                        <div class="icon-button" id="locationButton" style="display: none;">
                            <img src="/icons/location_icon.svg" class="icon"/>
                        </div>

                        <div class="icon-button" id="dateButton" style="display: none;">
                            <img src="/icons/calendar_icon.svg" class="icon"/>
                        </div>
                    </div>
                    <p style="font-size: 12px; color: gray; margin-left: 2px;"> Podporované formáty: .jpg .jpeg .png </p>
                    <div id="actionFields" class="extra-fields" style="display: none;">
                        <input type="text" id="location" name="location" class="input-field location-field" style="display: none;"/>
                        <input type="date" id="eventDate" name="eventDate" class="input-field date-field" style="display: none;"/>
                    </div>
                    <div id="imagePreviewContainer" style="display:none;">
                        <button type="button" id="removeImageButton" class="remove-image">&times;</button>
                        <img id="imagePreview" src="" alt="Image Preview" />
                    </div>
                    @{
                        var communityId = Context.Request.Query["communityId"].ToString();
                    }
                    <input type="hidden" name="CommunityId" value="@communityId" />


                    <button type="button" class="publish-button ButtonPublish" id="publishPost">Publikovat</button>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
    // validation functions
    function validateForm() {
        const titleInput = document.getElementById('postTitle');
        const contentInput = document.getElementById('postContent');
        let isValid = true;

        // Reset error messages
        document.getElementById('titleError').style.display = 'none';
        document.getElementById('contentError').style.display = 'none';

        // Validate title
        if (!titleInput.value.trim()) {
            document.getElementById('titleError').style.display = 'block';
            isValid = false;
        }

        // Validate content
        if (!contentInput.value.trim()) {
            document.getElementById('contentError').style.display = 'block';
            isValid = false;
        }

        return isValid;
    }

    // Add character counters
    document.getElementById('postTitle').addEventListener('input', function() {
        const length = this.value.length;
        document.getElementById('titleLength').textContent = `${length}/100`;
    });

    document.getElementById('postContent').addEventListener('input', function() {
        const length = this.value.length;
        document.getElementById('contentLength').textContent = `${length}/1000`;
    });
    
    document.addEventListener("DOMContentLoaded", function () {
        var publishButton = document.getElementById("publishPost");
        var form = document.getElementById("createPostForm");
        var modal = new bootstrap.Modal(document.getElementById("createPostModal"));
        
        if (publishButton && modal && form) {
            // Handle publish button click
            publishButton.addEventListener("click", function () {
                if (validateForm()) {
                    // Only submit if validation passes
                    form.submit();
                    modal.hide();
                }
            });
        }
    });
    
    document.addEventListener("DOMContentLoaded", function () {
        var discussionButton = document.getElementById("discussionButton");
        var actionButton = document.getElementById("actionButton");
        var petitionButton = document.getElementById("petitionButton");
        var postTitleHeader = document.getElementById("postTitleHeader");
        var postTitleInput = document.getElementById("postTitle");
        var postContentTextarea = document.getElementById("postContent");
        var actionFields = document.getElementById("actionFields");

        // Funkce pro změnu nadpisu a placeholderů na základě typu příspěvku
        // discussionButton.addEventListener("click", function () {
        //     postTitleHeader.innerHTML = "Vytvořit diskuzi";
        //     postContentTextarea.placeholder = "Co se děje u vás?";
        //     postTitleInput.placeholder = "O co se jedná?";
        //     actionFields.style.display = "none";  // Skrýt sekci pro "Akce"
        //     toggleIcons(false);  // Skryj ikonky pro lokaci a datum
        //     updateActiveButton(discussionButton);
        // });
        //
        // actionButton.addEventListener("click", function () {
        //     postTitleHeader.innerHTML = "Vytvořit akci";
        //     postContentTextarea.placeholder = "Co se bude konat?";
        //     postTitleInput.placeholder = "O co se jedná?";
        //     actionFields.style.display = "false";  // Zobrazit sekci pro "Akce"
        //     toggleIcons(true);  // Zobraz ikonky pro lokaci a datum
        //     updateActiveButton(actionButton);
        // });
        //
        // petitionButton.addEventListener("click", function () {
        //     postTitleHeader.innerHTML = "Vytvořit petici";
        //     postContentTextarea.placeholder = "Co chceme jinak?";
        //     postTitleInput.placeholder = "O co se jedná?";
        //     actionFields.style.display = "none";  // Skrýt sekci pro "Akce"
        //     toggleIcons(false);  // Skryj ikonky pro lokaci a datum
        //     updateActiveButton(petitionButton);
        // });

        // Funkce pro aktivaci tlačítka
        function updateActiveButton(activeButton) {
            var buttons = document.querySelectorAll(".type-button");
            buttons.forEach(function(button) {
                button.classList.remove("active");
            });
            activeButton.classList.add("active");
        }

        // Funkce pro zobrazení/skrytí vstupních polí pro lokaci a datum
        function toggleIcons(show) {
            var locationButton = document.getElementById("locationButton");
            var dateButton = document.getElementById("dateButton");

            // Pokud je vybrána akce, zobraz ikonky
            if (show) {
                locationButton.style.display = "block";
                dateButton.style.display = "block";
            } else {
                locationButton.style.display = "none";
                dateButton.style.display = "none";
            }
        }
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        var openModalButton = document.getElementById("openModalButton");
        var modal = new bootstrap.Modal(document.getElementById("createPostModal"));

        if (openModalButton && modal) {
            openModalButton.addEventListener("click", function () {
                modal.show();
            });
        }
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        var removeImageButton = document.getElementById("removeImageButton");
        var imagePreview = document.getElementById("imagePreview");
        var imagePreviewContainer = document.getElementById("imagePreviewContainer");
        var imageInput = document.getElementById("uploadImage");
        // Funkce pro zobrazení náhledu obrázku
        imageInput.addEventListener("change", function (event) {
            var file = event.target.files[0];
            if (file) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    var imagePreview = document.getElementById("imagePreview");
                    imagePreview.src = e.target.result;  // Nastavíme obrázek jako Data URL
                    document.getElementById("imagePreviewContainer").style.display = "block";  // Zobrazíme náhled
                };

                reader.readAsDataURL(file);  // Načteme obrázek jako Data URL
            }
        });
        removeImageButton.addEventListener("click", function () {
            imagePreview.src = "";
            imagePreviewContainer.style.display = "none";
            imageInput.value = ""; // Resetuje vstup souboru
        });
    });
</script>